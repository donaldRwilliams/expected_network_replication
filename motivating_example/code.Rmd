---
title: "motivating example"
author: "Donny Williams"
date: "8/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Required packages
```{r}
library(BGGM)
library(ggplot2)
library(corpcor)
library(GGMnonreg)

```

Note that the first three can be installed from CRAN with `install.packages()`, whereas the third can be installed
from github with `devtools::install_github("donaldRwilliams/GGMnonreg")`. 

## Figure 1: Sample Correlations

```{r}
# correlations
cors <- BGGM::ptsd_cor1

pcs <- corpcor::cor2pcor(cors)

data1 <- pcs[upper.tri(pcs)]

data2 <- cors[upper.tri(cors)]




dat <- data.frame(x = c(data1, data2), 
               Type=rep(c("Partial", "Zero-order"), 
                        c(length(data1), length(data2))))
ggplot(dat) + 
  geom_histogram(aes(x = x, 
                     fill = Type), 
                 colour ="white", 
                 alpha=0.60, 
                 position="identity", 
                 binwidth = .025, 
                 size = 1) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(), 
        legend.position = "top", 
        axis.title = element_text(size = 14), 
        legend.text = element_text(size = 12), 
        panel.grid.major = element_line(color = "grey90", 
                                        linetype = "dotted"), legend.title = element_blank()) +
  scale_y_continuous(expand = c(0,0), 
                     limits = c(0, 16), 
                     breaks = seq(0,15,5)) +
  ylab("Count") +
  xlab("Sample Correlation Coefficients") +
  scale_fill_manual(values = c("#CC79A7", "#009E73"), 
                    labels = c(expression("Partial"~"("*italic(p)~"= 16)"),"Zero-Order"))

```


## Figure 1: Controlling for Variables
```{r}
n <- seq(150, 500)
ord <- c(0, seq(20, 100, 20))
reps <- c(2, 4, 8)

ls <- list()

for(i in 1:length(ord)){
  ls[[i]] <-  do.call(rbind.data.frame, lapply(1:3, function(x) { 
    temp <- power_z(r = 0.2, 
                    c = ord[i], 
                    n = n)^reps[x]
    data.frame(order = ord[i], 
               n = n, 
               power = temp, group = paste("Networks =", reps[x]))
  }))
}


dat <- do.call(rbind.data.frame, 
               ls)

dat$facet <- "one"

dat$facet <- factor(dat$facet, levels = c("one"),
                   labels = expression(italic(rho)~"= 0.10"))

ggplot(dat, aes(x = as.factor(n), 
                     y = power, 
                     color = as.factor(order), 
                     group = as.factor(order))) +
  theme_bw()+
  facet_grid(~ group) +
  annotate("rect", xmin = -Inf, 
           xmax = Inf, ymin = 0.80, 
           ymax = Inf, alpha = 0.1) +
  geom_hline(yintercept = 0.80, 
             linetype = "dotted") +
  geom_line(size = 1.5, alpha = .8) +
  scale_y_continuous(breaks = seq(0, 1, 0.1)) +
  theme(panel.grid = element_blank(),  legend.position = "top",
        strip.background = element_rect(fill = "grey97"),
        axis.text.x = element_text(angle = 90, vjust = 0),
        panel.spacing = unit(2, "lines"), 
        plot.title = element_text(size = 20)
        ) +
  ggthemes::scale_color_colorblind(name = "Order") +
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  scale_x_discrete( breaks = seq(150, 500, 1), 
                    labels = c("150", rep("", 349), "500")) +
  ylab("Probability of Success") +
  xlab("Sample Size") +
  guides(col = guide_legend(nrow = 1, 
                            byrow = TRUE, 
                            override.aes = list(alpha = 1))) 
  


```



